package com.luciddreaming.http;

public class AutomationEditorTemplate {
    public static String generateHTML() {
        return "<!DOCTYPE html><html lang=\"zh-CN\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>自动化编辑器 - Lucid Dreaming</title><style>:root{--bg-primary:#fff;--bg-secondary:#f8fafc;--bg-card:#fff;--bg-hover:#f1f5f9;--text-primary:#1e293b;--text-secondary:#64748b;--text-muted:#94a3b8;--border-color:#e2e8f0;--border-hover:#cbd5e1;--accent-green:#10b981;--accent-blue:#0ea5e9;--accent-primary:#0ea5e9;--accent-primary-hover:#0284c7;--success:#10b981;--error:#ef4444;--warning:#f59e0b;--shadow-sm:0 1px 2px rgba(0,0,0,.05);--shadow-md:0 4px 6px rgba(0,0,0,.1);--shadow-lg:0 10px 15px rgba(0,0,0,.1);--radius-sm:6px;--radius-md:8px;--radius-lg:12px;--spacing-xs:.25rem;--spacing-sm:.5rem;--spacing-md:1rem;--spacing-lg:1.5rem;--font-sans:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans',Helvetica,Arial,sans-serif;--transition-fast:150ms ease;--transition-base:200ms ease;--block-event:#FF6B6B;--block-motion:#4ECDC4;--block-sensing:#FFE66D;--block-control:#95E1D3}[data-theme=\"dark\"]{--bg-primary:#0f172a;--bg-secondary:#1e293b;--bg-card:#1e293b;--bg-hover:#334155;--text-primary:#f1f5f9;--text-secondary:#cbd5e1;--text-muted:#64748b;--border-color:#334155;--border-hover:#475569;--shadow-sm:0 1px 2px rgba(0,0,0,.3);--shadow-md:0 4px 6px rgba(0,0,0,.4);--shadow-lg:0 10px 15px rgba(0,0,0,.4)}*{margin:0;padding:0;box-sizing:border-box}html{font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{font-family:var(--font-sans);background-color:var(--bg-primary);color:var(--text-primary);line-height:1.6;min-height:100vh;transition:background-color var(--transition-base),color var(--transition-base);overflow:hidden}.editor-container{display:flex;flex-direction:column;height:100vh}.editor-header{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md) var(--spacing-lg);border-bottom:1px solid var(--border-color);background-color:var(--bg-card);flex-shrink:0}.header-left{display:flex;align-items:center;gap:var(--spacing-md)}.header-title{font-size:1.25rem;font-weight:600;color:var(--text-primary)}.header-controls{display:flex;align-items:center;gap:var(--spacing-sm)}.btn{display:inline-flex;align-items:center;justify-content:center;gap:var(--spacing-sm);padding:var(--spacing-sm) var(--spacing-md);font-size:.875rem;font-weight:500;border:1px solid var(--border-color);border-radius:var(--radius-md);background-color:var(--bg-card);color:var(--text-primary);cursor:pointer;transition:all var(--transition-fast);white-space:nowrap}.btn:hover{background-color:var(--bg-hover);border-color:var(--border-hover)}.btn-primary{background-color:var(--accent-primary);border-color:var(--accent-primary);color:#fff}.btn-primary:hover{background-color:var(--accent-primary-hover);border-color:var(--accent-primary-hover)}.btn-danger{background-color:var(--error);border-color:var(--error);color:#fff}.btn-danger:hover{background-color:#dc2626;border-color:#dc2626}.btn-icon{width:18px;height:18px;flex-shrink:0}.btn svg{width:100%;height:100%}.editor-main{display:flex;flex:1;overflow:hidden}.blocks-sidebar{width:280px;background-color:var(--bg-secondary);border-right:1px solid var(--border-color);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0}.sidebar-header{padding:var(--spacing-md);border-bottom:1px solid var(--border-color);font-weight:600;font-size:.9375rem;color:var(--text-primary)}.category-tabs{display:flex;overflow-x:auto;border-bottom:1px solid var(--border-color);background-color:var(--bg-card)}.category-tab{padding:var(--spacing-sm) var(--spacing-md);font-size:.875rem;font-weight:500;color:var(--text-secondary);cursor:pointer;transition:all var(--transition-fast);border:none;background:0 0;white-space:nowrap;flex-shrink:0}.category-tab:hover{color:var(--text-primary);background-color:var(--bg-hover)}.category-tab.active{color:var(--text-primary);background-color:var(--bg-secondary);border-bottom:2px solid var(--accent-primary)}.blocks-list{flex:1;overflow-y:auto;padding:var(--spacing-sm)}.block-item{padding:var(--spacing-sm) var(--spacing-md);margin-bottom:var(--spacing-sm);border-radius:var(--radius-md);cursor:grab;transition:all var(--transition-fast);user-select:none;font-size:.875rem;font-weight:500;display:flex;align-items:center;gap:var(--spacing-sm)}.block-item:hover{transform:translateX(2px);box-shadow:var(--shadow-md)}.block-item:active{cursor:grabbing}.block-item.event{background-color:var(--block-event);color:#fff}.block-item.motion{background-color:var(--block-motion);color:#1a1a1a}.block-item.sensing{background-color:var(--block-sensing);color:#1a1a1a}.block-item.control{background-color:var(--block-control);color:#1a1a1a}.editor-workspace{flex:1;display:flex;overflow:hidden}.blocks-canvas{flex:1;background-color:var(--bg-primary);overflow:auto;padding:var(--spacing-lg);position:relative}.screenshot-panel{width:320px;background-color:var(--bg-secondary);border-left:1px solid var(--border-color);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0}.screenshot-header{padding:var(--spacing-md);border-bottom:1px solid var(--border-color);font-weight:600;font-size:.9375rem;color:var(--text-primary)}.screenshot-content{flex:1;display:flex;align-items:center;justify-content:center;padding:var(--spacing-md)}.screenshot-content img{max-width:100%;max-height:100%;border-radius:var(--radius-md);box-shadow:var(--shadow-md)}.screenshot-placeholder{text-align:center;color:var(--text-muted)}.screenshot-placeholder svg{width:48px;height:48px;margin-bottom:var(--spacing-sm)}.screenshot-actions{padding:var(--spacing-md);border-top:1px solid var(--border-color);display:flex;gap:var(--spacing-sm)}.canvas-block{padding:var(--spacing-sm) var(--spacing-md);margin-bottom:var(--spacing-xs);border-radius:var(--radius-md);font-size:.875rem;font-weight:500;display:inline-flex;align-items:center;gap:var(--spacing-sm);position:relative}.canvas-block.event{background-color:var(--block-event);color:#fff;margin-bottom:var(--spacing-lg)}.canvas-block.motion{background-color:var(--block-motion);color:#1a1a1a}.canvas-block.sensing{background-color:var(--block-sensing);color:#1a1a1a}.canvas-block.control{background-color:var(--block-control);color:#1a1a1a}.canvas-block .delete-btn{position:absolute;right:4px;top:50%;transform:translateY(-50%);width:20px;height:20px;border-radius:50%;background-color:rgba(0,0,0,.2);border:none;color:#fff;cursor:pointer;display:none;align-items:center;justify-content:center;font-size:12px;line-height:1}.canvas-block:hover .delete-btn{display:flex}.canvas-block .delete-btn:hover{background-color:rgba(239,68,68,.8)}.canvas-block input{background:rgba(255,255,255,.3);border:1px solid rgba(0,0,0,.2);border-radius:4px;padding:2px 6px;font-size:.8125rem;width:60px;color:inherit}.canvas-block input:focus{outline:none;border-color:var(--accent-primary)}@media(max-width:1024px){.blocks-sidebar{width:240px}.screenshot-panel{width:240px}}@media(max-width:768px){.editor-main{flex-direction:column}.blocks-sidebar{width:100%;height:200px;border-right:none;border-bottom:1px solid var(--border-color)}.screenshot-panel{display:none}}</style></head><body><div class=\"editor-container\"><header class=\"editor-header\"><div class=\"header-left\"><a href=\"/automation\" class=\"btn\"><span class=\"btn-icon\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M19 12H5M12 19l-7-7 7-7\"/></svg></span><span>返回</span></a><h1 class=\"header-title\" id=\"taskTitle\">自动化编辑器</h1></div><div class=\"header-controls\"><button class=\"btn\" onclick=\"loadScreenshot()\"><span class=\"btn-icon\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z\"/><circle cx=\"12\" cy=\"13\" r=\"4\"/></svg></span><span>刷新截图</span></button><button class=\"btn btn-primary\" onclick=\"saveTask()\"><span class=\"btn-icon\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z\"/><polyline points=\"17 21 17 13 7 13 7 21\"/><polyline points=\"7 3 7 8 15 8\"/></svg></span><span>保存</span></button><button class=\"btn\" onclick=\"runTask()\" id=\"runBtn\"><span class=\"btn-icon\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polygon points=\"5 3 19 12 5 21 5 3\"/></svg></span><span>试运行</span></button><button class=\"btn btn-danger\" onclick=\"stopTask()\" id=\"stopBtn\" style=\"display:none\"><span class=\"btn-icon\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"6\" y=\"4\" width=\"4\" height=\"16\"/><rect x=\"14\" y=\"4\" width=\"4\" height=\"16\"/></svg></span><span>急停</span></button></div></header><div class=\"editor-main\"><div class=\"blocks-sidebar\"><div class=\"sidebar-header\">积木选择</div><div class=\"category-tabs\" id=\"categoryTabs\"><button class=\"category-tab active\" data-category=\"event\">事件</button><button class=\"category-tab\" data-category=\"motion\">运动</button><button class=\"category-tab\" data-category=\"sensing\">侦测</button><button class=\"category-tab\" data-category=\"control\">控制</button></div><div class=\"blocks-list\" id=\"blocksList\"><div style=\"padding:var(--spacing-md);text-align:center;color:var(--text-muted)\">加载中...</div></div></div><div class=\"editor-workspace\"><div class=\"blocks-canvas\" id=\"blocksCanvas\"><div style=\"color:var(--text-muted);text-align:center;padding:var(--spacing-xl)\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"width:48px;height:48px;margin-bottom:var(--spacing-md)\"><path d=\"M12 19l7-7 3 3-7 7-3-3z\"/><path d=\"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\"/><path d=\"M2 2l7.586 7.586\"/><circle cx=\"11\" cy=\"11\" r=\"2\"/></svg><p>从左侧选择积木，拖拽到这里</p></div></div><div class=\"screenshot-panel\"><div class=\"screenshot-header\">游戏截图</div><div class=\"screenshot-content\" id=\"screenshotContent\"><div class=\"screenshot-placeholder\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/><circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/><polyline points=\"21 15 16 10 5 21\"/></svg><p>点击\"刷新截图\"按钮</p></div></div><div class=\"screenshot-actions\"><button class=\"btn\" style=\"flex:1\" onclick=\"loadScreenshot()\">刷新</button></div></div></div></div></div><script>let taskId=null,taskData=null,currentCategory='event',blocksData={},canvasBlocks=[],triggerBlock=null,autoRefreshInterval=null;function getTaskId(){return new URLSearchParams(window.location.search).get('id')}async function loadBlocks(){try{const e=await fetch('/api/automation/blocks'),t=await e.json();blocksData=t.blocks,renderBlocksList()}catch(e){console.error('加载积木失败:',e)}}function renderBlocksList(){const e=document.getElementById('blocksList'),t=blocksData[currentCategory]||[];e.innerHTML=t.map(e=>`<div class=\"block-item ${currentCategory}\" draggable=\"true\" data-type=\"${e.type}\" data-display=\"${e.displayName}\" data-params=\"${e.parameters.join(',')}\"><span>${e.displayName}</span></div>`).join(''),e.querySelectorAll('.block-item').forEach(e=>e.addEventListener('dragstart',handleDragStart))}document.getElementById('categoryTabs').addEventListener('click',e=>{if(e.target.classList.contains('category-tab')){document.querySelectorAll('.category-tab').forEach(e=>e.classList.remove('active')),e.target.classList.add('active'),currentCategory=e.target.dataset.category,renderBlocksList()}});function handleDragStart(e){e.dataTransfer.setData('text/plain',JSON.stringify({type:e.target.dataset.type,display:e.target.dataset.display,params:e.target.dataset.params.split(','),category:currentCategory}))}const canvas=document.getElementById('blocksCanvas');canvas.addEventListener('dragover',e=>{e.preventDefault(),e.dataTransfer.dropEffect='copy'}),canvas.addEventListener('drop',e=>{e.preventDefault();const t=JSON.parse(e.dataTransfer.getData('text/plain'));addBlockToCanvas(t)});function addBlockToCanvas(e,t=null){const o={id:'block_'+Date.now()+'_'+Math.random().toString(36).substr(2,9),type:e.type,category:e.category,display:e.display,parameters:{}};e.params.forEach(e=>{e&&(o.parameters[e]='')}),e.category==='event'?triggerBlock=o:(null!==t?canvasBlocks.splice(t,0,o):canvasBlocks.push(o)),renderCanvas()}function renderCanvas(){const e=document.getElementById('blocksCanvas');if(0===canvasBlocks.length&&!triggerBlock){e.innerHTML='<div style=\"color:var(--text-muted);text-align:center;padding:var(--spacing-xl)\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"width:48px;height:48px;margin-bottom:var(--spacing-md)\"><path d=\"M12 19l7-7 3 3-7 7-3-3z\"/><path d=\"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\"/><path d=\"M2 2l7.586 7.586\"/><circle cx=\"11\" cy=\"11\" r=\"2\"/></svg><p>从左侧选择积木，拖拽到这里</p></div>';return}let t='';triggerBlock&&(t+=createBlockElement(triggerBlock,!0),t+='<div style=\"margin:var(--spacing-md) 0;border-bottom:2px dashed var(--border-color)\"></div>'),canvasBlocks.forEach((e,o)=>{t+=createBlockElement(e,!1,o)}),e.innerHTML=t,e.querySelectorAll('.delete-btn').forEach(e=>e.addEventListener('click',t=>{t.stopPropagation();const o=t.target.dataset.blockId;triggerBlock&&triggerBlock.id===o?triggerBlock=null:canvasBlocks=canvasBlocks.filter(e=>e.id!==o),renderCanvas()})),e.querySelectorAll('.block-input').forEach(e=>e.addEventListener('change',t=>{const o=t.target.dataset.blockId,i=t.target.dataset.param,l=t.target.value;triggerBlock&&triggerBlock.id===o?triggerBlock.parameters[i]=l:canvasBlocks.find(e=>e.id===o)&&(canvasBlocks.find(e=>e.id===o).parameters[i]=l)}))}function createBlockElement(e,t=!1,o=null){let i='';return e.parameters&&Object.keys(e.parameters).length>0&&Object.keys(e.parameters).forEach(t=>{const o=e.parameters[t]||'',l=getPlaceholder(t);i+=`<input type=\"text\" class=\"block-input\" data-block-id=\"${e.id}\" data-param=\"${t}\" value=\"${escapeHtml(o)}\" placeholder=\"${l}\">`}),`<div class=\"canvas-block ${e.category}\" data-block-id=\"${e.id}\"><span>${e.display}</span>${i}<button class=\"delete-btn\" data-block-id=\"${e.id}\">×</button></div>`}function getPlaceholder(e){const t={yaw:'方向',degrees:'度数',blocks:'格数',x:'X',y:'Y',z:'Z',radius:'半径',seconds:'秒',times:'次数',scoreboard:'计分板名',health:'血量',from:'从',to:'到',condition:'条件',text:'文本'};return t[e]||e}async function loadTask(){if(taskId=getTaskId(),!taskId){alert('未指定任务 ID'),window.location.href='/automation';return}try{const e=await fetch(`/api/automation/${taskId}`),t=await e.json();t.task?(taskData=t.task,document.getElementById('taskTitle').textContent=`编辑: ${taskData.name}`,triggerBlock=t.trigger?{id:t.trigger.id||'block_'+Date.now(),type:t.trigger.type,category:'event',display:getBlockDisplayName(t.trigger.type),parameters:t.trigger.parameters||{}}:null,canvasBlocks=t.blocks&&t.blocks.length>0?t.blocks.map(e=>({id:e.id||'block_'+Date.now()+'_'+Math.random(),type:e.type,category:getBlockCategory(e.type),display:getBlockDisplayName(e.type),parameters:e.parameters||{}})):[],renderCanvas(),checkTaskStatus()):(alert('任务不存在'),window.location.href='/automation')}catch(e){console.error('加载任务失败:',e),alert('加载任务失败')}}function getBlockDisplayName(e){for(const t in blocksData){const o=blocksData[t].find(t=>t.type===e);if(o)return o.displayName}return e}function getBlockCategory(e){for(const t in blocksData)if(blocksData[t].find(t=>t.type===e))return t;return'control'}async function saveTask(){if(!taskId||!taskData)return void alert('任务数据未加载');try{const e=canvasBlocks.map(e=>({type:e.type,category:e.category,parameters:e.parameters})),t=triggerBlock?{type:triggerBlock.type,category:triggerBlock.category,parameters:triggerBlock.parameters}:null,o=await fetch(`/api/automation/${taskId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({blocks:e,trigger:t})});o.ok?alert('保存成功'):alert('保存失败')}catch(e){console.error('保存失败:',e),alert('保存失败: '+e.message)}}async function runTask(){if(!taskId)return void alert('任务未加载');try{await saveTask();const e=await fetch(`/api/automation/${taskId}/run`,{method:'POST'});e.ok?(document.getElementById('runBtn').style.display='none',document.getElementById('stopBtn').style.display='inline-flex',startAutoRefresh()):alert('运行失败')}catch(e){console.error('运行失败:',e),alert('运行失败: '+e.message)}}async function stopTask(){if(taskId)try{const e=await fetch(`/api/automation/${taskId}/stop`,{method:'POST'});e.ok&&(document.getElementById('runBtn').style.display='inline-flex',document.getElementById('stopBtn').style.display='none',stopAutoRefresh())}catch(e){console.error('停止失败:',e)}}async function checkTaskStatus(){if(taskId)try{const e=await fetch(`/api/automation/${taskId}`),t=await e.json();t.task&&t.task.running?(document.getElementById('runBtn').style.display='none',document.getElementById('stopBtn').style.display='inline-flex'):(document.getElementById('runBtn').style.display='inline-flex',document.getElementById('stopBtn').style.display='none')}catch(e){console.error('检查状态失败:',e)}}function startAutoRefresh(){autoRefreshInterval&&(clearInterval(autoRefreshInterval)),autoRefreshInterval=setInterval(()=>{checkTaskStatus(),loadScreenshot()},1e3)}function stopAutoRefresh(){autoRefreshInterval&&(clearInterval(autoRefreshInterval),autoRefreshInterval=null)}async function loadScreenshot(){const e=document.getElementById('screenshotContent');try{const t=await fetch('/api/screenshot');if(!t.ok){e.innerHTML='<div class=\"screenshot-placeholder\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/><circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/><polyline points=\"21 15 16 10 5 21\"/></svg><p>截图功能未启用</p></div>';return}const o=await t.blob(),i=URL.createObjectURL(o);e.innerHTML=`<img src=\"${i}\" alt=\"游戏截图\">`}catch(t){console.error('加载截图失败:',t),e.innerHTML='<div class=\"screenshot-placeholder\"><svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/><circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/><polyline points=\"21 15 16 10 5 21\"/></svg><p>加载失败</p></div>'}}function escapeHtml(e){const t=document.createElement('div');return t.textContent=e,t.innerHTML}window.addEventListener('beforeunload',()=>{stopAutoRefresh()}),loadBlocks().then(()=>{loadTask()}),loadScreenshot()</script></body></html>";
    }
}
